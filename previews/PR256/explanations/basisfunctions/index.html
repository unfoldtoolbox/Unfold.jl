<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Basisfunctions ¬∑ Unfold.jl Timeseries Analysis &amp; Deconvolution</title><meta name="title" content="Basisfunctions ¬∑ Unfold.jl Timeseries Analysis &amp; Deconvolution"/><meta property="og:title" content="Basisfunctions ¬∑ Unfold.jl Timeseries Analysis &amp; Deconvolution"/><meta property="twitter:title" content="Basisfunctions ¬∑ Unfold.jl Timeseries Analysis &amp; Deconvolution"/><meta name="description" content="Documentation for Unfold.jl Timeseries Analysis &amp; Deconvolution."/><meta property="og:description" content="Documentation for Unfold.jl Timeseries Analysis &amp; Deconvolution."/><meta property="twitter:description" content="Documentation for Unfold.jl Timeseries Analysis &amp; Deconvolution."/><meta property="og:url" content="https://unfoldtoolbox.github.io/Unfold.jl/explanations/basisfunctions/"/><meta property="twitter:url" content="https://unfoldtoolbox.github.io/Unfold.jl/explanations/basisfunctions/"/><link rel="canonical" href="https://unfoldtoolbox.github.io/Unfold.jl/explanations/basisfunctions/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Unfold.jl Timeseries Analysis &amp; Deconvolution logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Unfold.jl Documentation</a></li><li><a class="tocitem" href="../../installation/">Installing Julia + Unfold.jl</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/lm_mu/">rERP (mass univariate)</a></li><li><a class="tocitem" href="../../tutorials/lm_overlap/">rERP (overlap correction)</a></li></ul></li><li><span class="tocitem">HowTo</span><ul><li><a class="tocitem" href="../../HowTo/multiple_events/">Multiple events</a></li><li><a class="tocitem" href="../../generated/HowTo/contrasts/">Change contrasts / coding schema</a></li><li><a class="tocitem" href="../../HowTo/standarderrors/">Standard errors</a></li><li><a class="tocitem" href="../../generated/HowTo/effects/">Marginal effects (must read re: splines)</a></li><li><a class="tocitem" href="../../HowTo/custom_solvers/">Alternative Solvers (Robust, GPU, B2B)</a></li><li><a class="tocitem" href="../../generated/HowTo/unfold_io/">Save and load Unfold models</a></li><li><a class="tocitem" href="../../generated/HowTo/FIRduration/">Duration-scaled basisfunctions (Hassall-style)</a></li><li><a class="tocitem" href="../../HowTo/pymne/">üêç Import EEG with PyMNE.jl</a></li><li><a class="tocitem" href="../../generated/HowTo/juliacall_unfold/">üêç Calling Unfold.jl directly from Python</a></li></ul></li><li><span class="tocitem">Explanations</span><ul><li><a class="tocitem" href="../../generated/explanations/nonlinear_effects/">Non-Linear effects</a></li><li class="is-active"><a class="tocitem" href>Basisfunctions</a><ul class="internal"><li><a class="tocitem" href="#HRF-/-BOLD"><span>HRF / BOLD</span></a></li><li><a class="tocitem" href="#FIR-Basis-Function"><span>FIR Basis Function</span></a></li></ul></li><li><a class="tocitem" href="../../generated/explanations/predict/">Predictions</a></li><li><a class="tocitem" href="../../generated/explanations/window_length/">Window Length Effect</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../references/extensions/">Overview of package extensions</a></li><li><a class="tocitem" href="../../generated/references/solver/">Solver/optimizer implementations</a></li><li><a class="tocitem" href="../../references/benchmarks/">Solver benchmarks</a></li><li><a class="tocitem" href="../../references/types/">API: Types</a></li><li><a class="tocitem" href="../../references/functions/">API: Functions</a></li></ul></li><li><span class="tocitem">Contributing</span><ul><li><a class="tocitem" href="../../90-contributing/">Contributing guidelines</a></li></ul></li><li><span class="tocitem">Developer Guide</span><ul><li><a class="tocitem" href="../../91-developer/">Developer documentation</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Explanations</a></li><li class="is-active"><a href>Basisfunctions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Basisfunctions</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/unfoldtoolbox/Unfold.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/unfoldtoolbox/Unfold.jl/blob/main/docs/src/explanations/basisfunctions.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Basis-Functions"><a class="docs-heading-anchor" href="#Basis-Functions">Basis Functions</a><a id="Basis-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Basis-Functions" title="Permalink"></a></h1><p>This document will give you an explanation of basis functions. We start with basis functions for fMRI because they are very popular.</p><h2 id="HRF-/-BOLD"><a class="docs-heading-anchor" href="#HRF-/-BOLD">HRF / BOLD</a><a id="HRF-/-BOLD-1"></a><a class="docs-heading-anchor-permalink" href="#HRF-/-BOLD" title="Permalink"></a></h2><p>We want to define a basis function. There are currently only few basisfunctions implemented in Unfold.jl, but your imagination knows no borders!</p><p>We first have a look at the BOLD-HRF basisfunction aka <a href="https://en.wikipedia.org/wiki/Blood-oxygen-level-dependent_imaging">Blood Oxygenation Level Dependent Hemodynamic Response Function</a>:</p><pre><code class="language-julia hljs">using Unfold, DSP

TR = 1.5 # the sampling rate
bold = hrfbasis(TR) # using default SPM parameters
eventonset = 1.3
bold_kernel = e -&gt; Unfold.kernel(bold, e)
lines(bold_kernel(eventonset)[:,1]) # returns a matrix, thus [:, 1]</code></pre><img src="cb208fac.png" alt="Example block output"/><p>This is the shape that is assumed to reflect the activity for an event. Generally, we would like to know how much to scale this response shape per condition, e.g. in <code>condA</code> we might scale it by 0.7, in <code>condB</code> by 1.2.</p><p>But let&#39;s start at the beginning and first simulate an fMRI signal. Then you will also appreciate why we need to deconvolve it later.</p><h3 id="Convolving-a-response-shape-to-get-a-&quot;recorded&quot;-fMRI-signal"><a class="docs-heading-anchor" href="#Convolving-a-response-shape-to-get-a-&quot;recorded&quot;-fMRI-signal">Convolving a response shape to get a &quot;recorded&quot; fMRI signal</a><a id="Convolving-a-response-shape-to-get-a-&quot;recorded&quot;-fMRI-signal-1"></a><a class="docs-heading-anchor-permalink" href="#Convolving-a-response-shape-to-get-a-&quot;recorded&quot;-fMRI-signal" title="Permalink"></a></h3><p>We start by convolving this HRF function with an impulse vector at event onsets.</p><pre><code class="language-julia hljs">y = zeros(100) # signal length = 100
y[[10, 30, 45]] .= 0.7 # 3 events at given for condition A
y[[37]] .= 1.2 # 1 events at given for condition B

y_conv = conv(y, bold_kernel(0)) # convolve!
lines(y_conv[:,1])</code></pre><img src="aaf5c728.png" alt="Example block output"/><p>Next, we would add some noise:</p><pre><code class="language-julia hljs">using Random
y_conv += randn(size(y_conv))
lines(y_conv[:,1])</code></pre><img src="f495fc86.png" alt="Example block output"/><p>üéâ - we did it, we simulated fMRI data.</p><p>Now you can see that the conditions overlap in time. To get back to the original amplitude values, we need to specify a basis function and use Unfold to deconvolve the signals.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Events can fall between TR (the sampling rate). Some packages subsample the time signal, but in <code>Unfold</code> we can call the <code>bold.kernel</code> function directly at a given event time, which allows us to use non-TR multiples.</p></div></div><h2 id="FIR-Basis-Function"><a class="docs-heading-anchor" href="#FIR-Basis-Function">FIR Basis Function</a><a id="FIR-Basis-Function-1"></a><a class="docs-heading-anchor-permalink" href="#FIR-Basis-Function" title="Permalink"></a></h2><p>Okay, let&#39;s have a look at a different basis function: The FIR basisfunction. FIR stands for <a href="https://en.wikipedia.org/wiki/Finite_impulse_response">Finite-Impulse-Response</a> and is a term taken from the filtering literature.</p><pre><code class="language-julia hljs">basisfunction = firbasis(œÑ=(-0.4,.8), sfreq=50, name=&quot;myFIRbasis&quot;)
fir_kernel = e -&gt; Unfold.kernel(basisfunction, e)
m = fir_kernel(0)
f = Figure()
f[1,1] = Axis(f)
for col = 1:size(m, 2)
    lines!(m[:,col])
end
current_figure()</code></pre><img src="9259f847.png" alt="Example block output"/><p>The first thing to notice is that it is not a single basisfunction, but a set of basisfunctions. So every condition is explained by several basis functions!</p><p>To make it clear better show it in 2D:</p><pre><code class="language-julia hljs">fir_kernel(0)[1:10,1:10]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">10√ó10 SparseArrays.SparseMatrixCSC{Int64, Int64} with 10 stored entries:
 1  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ
 ‚ãÖ  1  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ
 ‚ãÖ  ‚ãÖ  1  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ
 ‚ãÖ  ‚ãÖ  ‚ãÖ  1  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ
 ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  1  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ
 ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  1  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ
 ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  1  ‚ãÖ  ‚ãÖ  ‚ãÖ
 ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  1  ‚ãÖ  ‚ãÖ
 ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  1  ‚ãÖ
 ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  ‚ãÖ  1</code></pre><p>(all <code>.</code> are <code>0</code>&#39;s)</p><p>The FIR basis set consists of multiple basis functions. That is, each event is now <em>time-expanded</em> to multiple predictors, each with a certain time delay to the event onset. This allows us to model any linear overlap shape, and doesn&#39;t force us to make assumptions about the convolution kernel, as we had to do in the BOLD case.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../generated/explanations/nonlinear_effects/">¬´ Non-Linear effects</a><a class="docs-footer-nextpage" href="../../generated/explanations/predict/">Predictions ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.9.0 on <span class="colophon-date" title="Thursday 27 March 2025 10:55">Thursday 27 March 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
